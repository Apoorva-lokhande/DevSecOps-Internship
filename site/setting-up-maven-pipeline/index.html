
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.2">
    
    
      
        <title>Jenkins Pipeline - DevSecOps-pipeline</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6f955dcd.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ef6f36e2.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#jenkins-pipeline" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="DevSecOps-pipeline" class="md-header__button md-logo" aria-label="DevSecOps-pipeline" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DevSecOps-pipeline
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Jenkins Pipeline
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="DevSecOps-pipeline" class="md-nav__button md-logo" aria-label="DevSecOps-pipeline" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    DevSecOps-pipeline
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../contents/" class="md-nav__link">
        Contents
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../setting-up-VM/" class="md-nav__link">
        Setting up VM
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../setting-up-jenkins/" class="md-nav__link">
        Setting up Jenkins
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../setting-up-mkdocs/" class="md-nav__link">
        Setting up mkDocs
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../setting-up-pipeline.md" class="md-nav__link">
        Setting up pipeline
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../setting-up-dvna/" class="md-nav__link">
        Setting up DVNA
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Source-Code-Quality-Analysis/" class="md-nav__link">
        Source-Code-Quality-Analysis
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../SCA/" class="md-nav__link">
        SCA
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../SAST/" class="md-nav__link">
        SAST
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Working-of-pipeline/" class="md-nav__link">
        Working-of-pipeline
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#why-use-jenkins-pipeline" class="md-nav__link">
    Why use Jenkins pipeline ?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-jenkins-pipeline" class="md-nav__link">
    Setup Jenkins Pipeline
  </a>
  
    <nav class="md-nav" aria-label="Setup Jenkins Pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-maven-plugin-in-jenkins" class="md-nav__link">
    Install Maven Plugin in Jenkins
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-a-maven-project-in-jenkins" class="md-nav__link">
    Create A Maven project in Jenkins.
  </a>
  
    <nav class="md-nav" aria-label="Create A Maven project in Jenkins.">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-is-jenkinsfile" class="md-nav__link">
    What is Jenkinsfile?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ssh-access-configuration" class="md-nav__link">
    SSH Access Configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ssh-into-vm" class="md-nav__link">
    SSH into VM
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#-also-i-changed-the-permissions-of-home-directory-to-remove-write-access-for-the-group-and-others" class="md-nav__link">
    - Also, I changed the permissions of home directory to remove write access for the group and others.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-ssh-keys-for-jenkins" class="md-nav__link">
    Setup SSH keys for Jenkins
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="jenkins-pipeline">Jenkins Pipeline</h1>
<h2 id="why-use-jenkins-pipeline">Why use Jenkins pipeline ?</h2>
<p>Jenkins is an open continuous integration server which has the ability to support the automation of software development processes. You can create multiple automation jobs with the help of use cases, and run them as a Jenkins pipeline.</p>
<p>Here are the reasons why you use should use Jenkins pipeline:</p>
<ul>
<li>Jenkins pipeline is implemented as a code which allows multiple users to edit and execute the pipeline process.</li>
<li>Pipelines are robust. So, if your server undergoes an unforeseen restart, the pipeline will be automatically resumed.</li>
<li>You can pause the pipeline process and make it wait to resume until there is an input from the user.</li>
<li>Jenkins Pipelines support big projects. You can run multiple jobs, and even use pipelines in a loop.</li>
</ul>
<h2 id="setup-jenkins-pipeline">Setup Jenkins Pipeline</h2>
<p>Here, we are using <a href="https://maven.apache.org/">Apache Maven</a> as a plugin which is a software project management and comprehension tool. Based on the concept of a project object model (POM), Maven can manage a project's build, reporting and documentation from a central piece of information.</p>
<p>Jenkins provides a particular job type, which explicitly provides options for configuring and executing a Maven project. This job type is called the <code>Maven project</code> Let’s see how we can create a Maven project in Jenkins and run the same.</p>
<h3 id="install-maven-plugin-in-jenkins">Install Maven Plugin in Jenkins</h3>
<ul>
<li>Click on the Manage Jenkins as shown below.</li>
</ul>
<p><img alt="image" src="/pictures/1.png" /></p>
<p><img alt="image" src="/pictures/new_1.png" /></p>
<ul>
<li>Under the System Configuration section, click on the Manage Plugins options.</li>
</ul>
<p><img alt="image" src="/pictures/manage-plugin.png" /></p>
<ul>
<li>Under the Plugin Manager, click on the Available tab and search for the maven plugin. It will show the Maven Integration plugin as a result and check the checkbox and select <code>install without restart</code>.</li>
</ul>
<p><img alt="image" src="/pictures/maven-install.png" /></p>
<ul>
<li>
<p>Once the plugin installs successfully, click the checkbox to restart Jenkins.</p>
</li>
<li>
<p>After the restart of Jenkins, the Maven Jenkins plugin will be installed successfully and ready for configuration.</p>
</li>
</ul>
<h2 id="create-a-maven-project-in-jenkins">Create A Maven project in Jenkins.</h2>
<ul>
<li>
<p>Firstly, we need to create a job. To create this, click on <code>New Item</code> option.</p>
</li>
<li>
<p>Now, enter item name as Jenkin-Maven and selct Maven project as shown below and click on <strong>OK</strong>.
  <img alt="image" src="/pictures/jenkin-maven.png" /></p>
</li>
<li>
<p>Here, under <code>general</code> section:</p>
<ul>
<li>I gave the description of the project.</li>
<li>Under <code>Source Code Management</code> I checked the <code>Git</code> option and provided the <a href="https://github.com/jenkins-docs/simple-java-maven-app">Github URl</a>. This helps jenkins to know where to fetch the project from.</li>
</ul>
</li>
<li>
<p>Under <code>Build Triggers</code>:</p>
<ul>
<li>I checked <code>Build whenever a SNAPSHOT dependency is built</code> this is convenient for automatically performing continuous integration. Jenkins will check the snapshot dependencies from the dependency element in the POM, as well as plugins and extensions used in POMs.</li>
<li>Later, clicked on <code>save</code> button.</li>
</ul>
</li>
</ul>
<h3 id="what-is-jenkinsfile">What is Jenkinsfile?</h3>
<p>Jenkins Pipeline has a customizable and scalable automation system that lets you build distribution pipeline scripts -  “Pipeline as Code”, these scripts are called JenkinsFile. 
A JenkinsFile stores the entire CI/CD process as code on the local machine. As such, the file can be reviewed and checked into a Source Code Management (SCM) platform (be it Git or SVN) along with your code. Hence, the term “Pipeline as Code”.</p>
<p>The structure of my jenkinsfile is as follows:</p>
<pre><code>pipeline {
    agent any

    stages {
        stage ('Compile Stage') {

            steps {
                withMaven(maven : 'maven_3_6_0') {
                    sh 'mvn clean compile'
                }
            }
        }

        stage ('Testing Stage') {

            steps {
                withMaven(maven : 'maven_3_6_0') {
                    sh 'mvn test'
                }
            }
        }


        stage ('Deployment Stage') {
            steps {
                withMaven(maven : 'maven_3_6_0') {
                    sh 'mvn deploy'
                }
            }
        }
    }
}
</code></pre>
<h2 id="ssh-access-configuration">SSH Access Configuration</h2>
<ul>
<li>Secure Shell Protocol (SSH) provides a secure channel over an unsecured network by using a client–server architecture, connecting an SSH client application with an SSH server. The standard TCP port for SSH is 22.</li>
</ul>
<h2 id="installation">Installation</h2>
<ul>
<li>
<p>In order to SSH into VM we need to install it!</p>
<p>sudo apt-get install openssh-server</p>
</li>
<li>
<p>Enable the ssh service by:</p>
<p>sudo systemctl enable ssh</p>
</li>
<li>
<p>Start the ssh service:</p>
<p>sudo systemctl start ssh</p>
</li>
</ul>
<h2 id="ssh-into-vm">SSH into VM</h2>
<ul>
<li>Goto VM - Settings &gt; Network &gt; Advanced &gt; Port Forwarding</li>
</ul>
<p><img alt="image" src="/pictures/vm-box.png" /></p>
<ul>
<li>
<p>After installing SSH, create a key pair on a client machine.</p>
<pre><code>ssh-keygen -t ed25519
</code></pre>
</li>
<li>
<p>The first prompt from the ssh-keygen command will ask you where to save the keys, I pressed <code>enter</code> to save as it was.</p>
</li>
<li>Similarly, <code>Creating passphrase</code> just pressed <code>enter</code>.</li>
<li>
<p>once the key is generated, place the public key on the server which you want to connect to. Following the command below:</p>
<pre><code>ssh-copy-id username@your_server_address
</code></pre>
</li>
<li>
<p>While copying the id I got an error "cannot create .ssh/ authorized keys permission denied", so I changed the permissions of the authorized_keys file and the folder/parent folders in which it is located.</p>
<pre><code>chmod 700 ~/.ssh
chmod 600 ~/.ssh/authorized_keys
</code></pre>
<h2 id="-also-i-changed-the-permissions-of-home-directory-to-remove-write-access-for-the-group-and-others">- Also, I changed the permissions of home directory to remove write access for the group and others.</h2>
<pre><code>chmod go-w ~
</code></pre>
</li>
<li>
<p>Provide the information as shown above.</p>
<pre><code>ssh username@server_ip_address
</code></pre>
</li>
<li>
<p>I got an error saying permission denied, I refered this  <a href="https://www.digitalocean.com/community/questions/ssh-permission-denied-please-try-again">documentation</a> and did the necessary changes which are:</p>
<ul>
<li>
<p>Type the below command in your termianl:</p>
<p>sudo nano /etc/ssh/sshd_config</p>
</li>
<li>
<p>And change permissions as given below:</p>
<p>PermitRootLogin yes
  PasswordAuthentication yes</p>
</li>
</ul>
</li>
<li>
<p>And don't forget to reload:
       sudo systemctl restart ssh.service</p>
</li>
<li></li>
<li>
<p>After installing SSH, create a key pair on a client machine.</p>
<p>ssh-keygen -t rsa
- The first prompt from the ssh-keygen command will ask you where to save the keys, I pressed <code>enter</code> to save as it was.
- Similarly, <code>Creating passphrase</code> just pressed <code>enter</code>.
- once the key is generated, place the public key on the server which you want to connect to. Following the command below:</p>
<p>ssh-copy-id username@your_server_address</p>
</li>
</ul>
<h2 id="setup-ssh-keys-for-jenkins">Setup SSH keys for Jenkins</h2>
<ul>
<li>
<p>You will need to create a public/private key as the Jenkins user on your Jenkins server, then copy the public key to the user you want to do the deployment with on your target server.</p>
</li>
<li>
<p>Generate public and private key on build server as user jenkins and paste the pub file contents onto the target server.</p>
</li>
<li>
<p>Make sure your .ssh dir has permissoins 700 and your authorized_keys file has permissions 644.</p>
</li>
<li>
<p>In the jenkins web control panel, install the plugin [Publish Over SSH](https://plugins.jenkins.io/publish-over-ssh/ and nagivate to "Manage Jenkins" -&gt; "Configure System" -&gt; "Publish over SSH".</p>
</li>
<li>
<p>Either enter the path of the file e.g. "var/lib/jenkins/.ssh/id_rsa", or paste in the same content as on the target server.</p>
</li>
<li>
<p>Enter your passphrase, server and user details, and you are good to go!</p>
</li>
</ul>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../assets/javascripts/workers/search.fe42c31b.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.4ea5477f.min.js"></script>
      
    
  </body>
</html>